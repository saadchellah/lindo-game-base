<!DOCTYPE HTML>
<html lang="fr">
    <head>
        <script>
        // Touch fix
        window.ontouchstart = function(e) {};

        // Init
        window.buildVersion = window.top.buildVersion;
        window.appVersion = window.top.appVersion;
        window.appInfo = {
            version: window.top.appVersion
        };

        window._ = {
            appVersion: window.appVersion,
            buildVersion: window.buildVersion,
            client: "android"
        };

        // ðŸ”¥ Device UUID generation (persistent across sessions)
        (function() {
            function getOrCreateUUID() {
                var uuid = localStorage.getItem('lindo_device_uuid');
                if (!uuid) {
                    uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                        var r = Math.random() * 16 | 0;
                        var v = c === 'x' ? r : (r & 0x3 | 0x8);
                        return v.toString(16);
                    });
                    localStorage.setItem('lindo_device_uuid', uuid);
                    console.log('[Lindo] Generated new device UUID:', uuid);
                }
                return uuid;
            }

            var deviceUUID = getOrCreateUUID();

            // Inject Cordova device plugin
            window.device = {
                cordova: '13.0.0',
                model: 'SM-G998U',
                platform: 'Android',
                uuid: deviceUUID,
                version: '15',
                manufacturer: 'samsung',
                isVirtual: false,
                serial: 'unknown'
            };

            console.log('[Lindo] Device info injected:', window.device.model, window.device.uuid);
        })();

        // Fake IndexedDB (not used by game)
        window.indexedDB = {};
        window.IDBDatabase = {};
        window.IDBTransaction = {};
        window.IDBCursor = {};
        window.IDBKeyRange = {};

        // Cordova plugins
        window.cordova = {
            plugins: {
                isemulator: {
                    assess: function(fct) {
                        fct(false);
                    }
                },
                Keyboard: {
                    close: function() {},
                    disableScroll: function() {},
                    show: function() {},
                    hideKeyboardAccessoryBar: function() {}
                },
                notification: {
                    local: false
                },
                pushNotification: {
                    onDeviceReady: function() {},
                    setUserId: function() {},
                    registerDevice: function() {}
                },
                sim: {
                    getSimInfo: function(success, error) {
                        success({
                            carrierName: 'unknown',
                            countryCode: '',
                            mcc: '',
                            mnc: ''
                        });
                    }
                }
            }
        };
        
        // macOS requestAnimationFrame fix
        if (window.top.platform == "darwin") {
            (function() {
                window.requestAnimationFrame = function(callback) {
                    var self = requestAnimationFrame;
                    self.queue.push(callback);
                    if (!self.timeout) {
                        self.timeout = setTimeout(function() {
                            var queue = self.queue;
                            self.queue = [];
                            self.timeout = null;
                            queue.forEach(function(q) {
                                q();
                            });
                        }, 16);
                    }
                };
                requestAnimationFrame.queue   = [];
                requestAnimationFrame.timeout = null;
            })();
        }

        // Game initialization
        window.initDofus = function(cb) {
            var head = document.getElementsByTagName('head')[0];

            var scriptScript = document.createElement('script');
            scriptScript.addEventListener('load', function() {
                var fixesScript = document.createElement('script');
                fixesScript.src = 'fixes.js';
                head.appendChild(fixesScript);
                cb();
            });
            scriptScript.src = 'build/script.js';
            head.appendChild(scriptScript);
        };
        
    </script>
        <meta charset="UTF-8">
        <link rel="stylesheet" href="build/styles-native.css" />
        <link rel="stylesheet" href="fixes.css" />
    </head>
    <body>
    </body>
    <!-- Dependencies -->
    <script src="keymaster2.js"></script>
</html>

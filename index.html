<!DOCTYPE HTML>
<html>

<head>
    <!-- ================================================================
             ðŸ”¥ PHASE 1: CRITICAL HARDWARE SPOOFING (Must be FIRST!)
             ================================================================ -->
    <script>
        // âœ… CRITICAL: Match EXACT RAM from real device (4GB = 4,294,967,296 bytes)
        Object.defineProperty(navigator, 'deviceMemory', {
            get: () => 4,
            configurable: true,
            enumerable: true
        });

        // âœ… CRITICAL: Set connection type for performance reports
        Object.defineProperty(navigator, 'connection', {
            get: () => ({
                type: 'wifi',
                effectiveType: '4g',
                downlink: 10,
                rtt: 50,
                saveData: false,
                onchange: null
            }),
            configurable: true,
            enumerable: true
        });

        // âœ… CRITICAL: Low-end CPU: 4 cores (budget processor)
        Object.defineProperty(navigator, 'hardwareConcurrency', {
            get: () => 4,
            configurable: true,
            enumerable: true
        });

        Object.defineProperty(navigator, 'platform', {
            get: () => 'Linux armv8l',
            configurable: true
        });

        Object.defineProperty(navigator, 'maxTouchPoints', {
            get: () => 5,
            configurable: true
        });

        // âœ… CRITICAL: Inject chrome.system.memory API for RAM capacity reporting
        if (!window.chrome) {
            window.chrome = {};
        }
        if (!window.chrome.system) {
            window.chrome.system = {};
        }
        window.chrome.system.memory = {
            getInfo: function (callback) {
                // Return exact RAM capacity from real device (4GB = 4,294,967,296 bytes)
                callback({
                    capacity: 4294967296,
                    availableCapacity: 4294967296 * 0.6  // ~60% available
                });
            }
        };
    </script>

    <!-- ================================================================
             ðŸ”¥ PHASE 2: GPU SPOOFING (Before any WebGL context creation)
             ================================================================ -->
    <script>
        const getParam = WebGLRenderingContext.prototype.getParameter;
        const getParam2 = WebGL2RenderingContext?.prototype?.getParameter;

        const spoofHandler = function (parameter) {
            // GPU identity - Adreno (TM) 506 (SM-A105FN low-end GPU)
            if (parameter === 37445) return 'Qualcomm';
            if (parameter === 37446) return 'Adreno (TM) 506';

            // WebGL version strings
            if (parameter === 7938) return 'WebGL 1.0 (OpenGL ES 2.0 Chromium)';
            if (parameter === 35724) return 'WebGL GLSL ES 1.0 (OpenGL ES 2.0 Chromium)';
            if (parameter === 7936) return 'WebKit';
            if (parameter === 7937) return 'WebKit WebGL';

            // GPU capabilities (lower for budget device)
            if (parameter === 3379) return 4096;   // MAX_TEXTURE_SIZE (lower)
            if (parameter === 34024) return 8192;  // MAX_RENDERBUFFER_SIZE (lower)

            return getParam.call(this, parameter);
        };

        WebGLRenderingContext.prototype.getParameter = spoofHandler;
        if (getParam2) {
            WebGL2RenderingContext.prototype.getParameter = spoofHandler;
        }
    </script>

    <!-- ================================================================
             ðŸ”¥ PHASE 3: SCREEN & WINDOW SPOOFING (Before DOM ready)
             ================================================================ -->
    <script>
        // Lower resolution screen (640x360) - SM-A105FN
        Object.defineProperties(screen, {
            width: { get: () => 640, configurable: true, enumerable: true },
            height: { get: () => 360, configurable: true, enumerable: true },
            availWidth: { get: () => 640, configurable: true, enumerable: true },
            availHeight: { get: () => 360, configurable: true, enumerable: true },
            colorDepth: { get: () => 24, configurable: true },
            pixelDepth: { get: () => 24, configurable: true }
        });

        // Device pixel ratio
        Object.defineProperty(window, 'devicePixelRatio', {
            get: () => 3,
            configurable: true
        });

        // Window dimensions
        Object.defineProperty(window, 'innerWidth', {
            get: () => 640,
            configurable: true
        });

        Object.defineProperty(window, 'innerHeight', {
            get: () => 360,
            configurable: true
        });

        function getOrCreateUUID() {
            var uuid = localStorage.getItem('lindo_device_uuid');
            if (!uuid) {
                // Generate 16-character hex UUID
                uuid = 'xxxxxxxxxxxxxxxx'.replace(/x/g, function () {
                    return Math.floor(Math.random() * 16).toString(16);
                });
                localStorage.setItem('lindo_device_uuid', uuid);
            }
            return uuid;
        }

        var deviceUUID = getOrCreateUUID();

        // Touch fix
        window.ontouchstart = function (e) { };

        // Init
        window.buildVersion = window.top.buildVersion;
        window.appVersion = window.top.appVersion;
        window.appInfo = {
            version: window.appVersion
        };

        window._ = {
            appVersion: window.appVersion,
            buildVersion: window.buildVersion,
            client: "android"
        };

        // Fake IndexedDB
        window.indexedDB = window.indexedDB || {};
        window.IDBDatabase = window.IDBDatabase || {};
        window.IDBTransaction = window.IDBTransaction || {};
        window.IDBCursor = window.IDBCursor || {};
        window.IDBKeyRange = window.IDBKeyRange || {};

        // Cordova Plugins
        window.cordova = {
            platformId: 'android',
            platformVersion: '14.0.1',
            version: '14.0.1',
            plugins: {
                device: {
                    getInfo: function (success) {
                        success(window.device);
                    }
                },
                isemulator: {
                    assess: function (callback) { callback(false); }
                },
                Keyboard: {
                    close: function () { },
                    disableScroll: function () { },
                    show: function () { },
                    hideKeyboardAccessoryBar: function () { }
                },
                notification: {
                    local: {
                        schedule: function () { },
                        cancel: function () { },
                        clear: function () { }
                    }
                },
                pushNotification: {
                    onDeviceReady: function () { },
                    setUserId: function () { },
                    registerDevice: function () { }
                },
                sim: {
                    getSimInfo: function (success, error) {
                        // Permission denied - READ_PHONE_STATE not granted
                        error('Permission denied: READ_PHONE_STATE');
                    },
                    hasReadPermission: function (success, error) {
                        // Simulate permission revoked (Android 6.0+)
                        success(false);
                    },
                    requestReadPermission: function (success, error) {
                        // User denies permission request
                        error('Permission request denied by user');
                    }
                },
                network: {
                    getConnectionInfo: function (success) {
                        success({ type: 'wifi' });
                    }
                },
                deviceMotion: {
                    getCurrentAcceleration: function (success) {
                        success({ x: 0.01, y: -0.02, z: 9.81 });
                    }
                },
                splashscreen: {
                    hide: function () { },
                    show: function () { }
                }
            }
        };

        // Device Info - SM-A105FN with Android 9
        window.device = {
            cordova: '14.0.1',
            model: 'SM-A105FN',
            platform: 'Android',
            uuid: deviceUUID,
            version: '9',
            manufacturer: 'samsung',
            isVirtual: false,
            serial: 'R38N8234ABC',
            brand: 'samsung',
            product: 'a10',
            device: 'a10',
            hardware: 'exynos',
            sdkVersion: 28,
            host: 'SWDH5218',
            incremental: 'PPR1.180610.011',
            fingerprint: 'samsung/a10/a10:9/PPR1.180610.011/AB234567:user/release-keys'
        };

        // Extra Cordova globals
        window.StatusBar = {
            hide: function () { },
            show: function () { },
            styleDefault: function () { },
            styleLightContent: function () { },
            styleBlackTranslucent: function () { }
        };

        window.plugins = window.cordova.plugins;

        // macOS RAF fix
        if (window.top.platform == "darwin") {
            (function () {
                window.requestAnimationFrame = function (callback) {
                    var self = requestAnimationFrame;
                    self.queue.push(callback);
                    if (!self.timeout) {
                        self.timeout = setTimeout(function () {
                            var queue = self.queue;
                            self.queue = [];
                            self.timeout = null;
                            queue.forEach(function (q) { q(); });
                        }, 16);
                    }
                };
                requestAnimationFrame.queue = [];
                requestAnimationFrame.timeout = null;
            })();
        }

        // Game init
        window.initDofus = function (cb) {
            var head = document.getElementsByTagName('head')[0];
            var scriptScript = document.createElement('script');
            scriptScript.addEventListener('load', function () {
                var fixesScript = document.createElement('script');
                fixesScript.src = 'fixes.js';
                head.appendChild(fixesScript);
                cb();
            });
            scriptScript.src = 'build/script.js';
            head.appendChild(scriptScript);
        };
    </script>

    <meta charset="UTF-8">
    <link rel="stylesheet" href="build/styles-native.css" />
    <link rel="stylesheet" href="fixes.css" />
</head>

<body>
</body>
<script src="keymaster2.js"></script>

</html>
